<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Implementation - Unitful.jl</title>
      
      
      
      
        <meta name="author" content="Andrew Keller">
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Unitful.jl">
    <meta property="og:image" content="None/../">
    <meta name="apple-mobile-web-app-title" content="Unitful.jl">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../None">
    <link rel="icon" type="image/x-icon" href="../None">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-54f87043f3.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../assets/Documenter.css">
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-indigo palette-accent-blue">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
          </span>
        
        Implementation
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/ajkeller34/Unitful.jl" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Unitful.jl
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          ajkeller34/Unitful.jl
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/ajkeller34/Unitful.jl/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/ajkeller34/Unitful.jl/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="current" title="Implementation" href="./">
      Implementation
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="A view from 30000 ft (or 9144 m)" href="#a-view-from-30000-ft-or-9144-m">
                A view from 30000 ft (or 9144 m)
              </a>
            </li>
          
            <li class="anchor">
              <a title="Creating new units" href="#creating-new-units">
                Creating new units
              </a>
            </li>
          
            <li class="anchor">
              <a title="Conversion and promotions" href="#conversion-and-promotions">
                Conversion and promotions
              </a>
            </li>
          
            <li class="anchor">
              <a title="Temperature conversion" href="#temperature-conversion">
                Temperature conversion
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
            
  <li>
    <a class="" title="License" href="../LICENSE/">
      License
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <p><a id='Design-and-implementation-1'></a></p>
<h1 id="design-and-implementation">Design and implementation</h1>
<p><a id='A-view-from-30000-ft-(or-9144-m)-1'></a></p>
<h2 id="a-view-from-30000-ft-or-9144-m">A view from 30000 ft (or 9144 m)</h2>
<p>Like SIUnits.jl, units are part of the type signature of a quantity. From there, the implementations diverge. Unitful.jl uses generated functions to enable more flexibility than found in SIUnits.jl. Support is targeted to Julia 0.5 and up.</p>
<p>We make an immutable <code>UnitDatum</code> that stores a base unit (expressed a bits type, either <code>NormalUnit</code> or <code>TemperatureUnit</code>), a rational exponent, and a prefix. We don't allow arbitrary floating point exponents of units because they probably aren't very useful. The prefixes on units (e.g. <code>nm</code> or <code>km</code>) may help to avoid overflow issues and general ugliness.</p>
<p>We define the immutable singleton <code>UnitData{T}</code>, where <code>T</code> is always a tuple of <code>UnitDatum</code> (variable number of arguments). Usually, the user interacts only with <code>UnitData{T}</code> objects, not <code>UnitDatum</code>.</p>
<p>We define methods <code>dimension</code> that turn, for example, <code>acre^2</code> into <code>[L]^4</code>. We can in principle add quantities with the same dimension (<code>acre [L]^2 + ft^2 [L]^2</code>), provided some "promotion" rules are given (see below). Note that dimensions cannot be determined by powers of the units: <code>ft^2</code> is an area, but so is <code>acre^1</code>.</p>
<p>We define unitful <em>Quantities</em> <code>RealQuantity{T&lt;:Real, Units}</code> and <code>FloatQuantity{T&lt;:AbstractFloat, Units}</code> where <code>Units</code> is a type <code>UnitData{T}</code>. To play nicely with <code>FloatRange</code> and <code>LinSpace</code>, we need <code>FloatQuantity &lt;: AbstractFloat</code>; we also have <code>RealQuantity &lt;: Real</code>. By putting units in the type signature of a quantity, staged functions can be used to offload as much of the unit computation to compile-time as is possible.</p>
<p><a id='Creating-new-units-1'></a></p>
<h2 id="creating-new-units">Creating new units</h2>
<p>Just use the <code>@unit</code> macro, providing four arguments: the symbol for the unit, how the unit is displayed, a quantity equivalent to one of the new unit, and a <code>Bool</code> to indicate whether or not to make symbols for all SI prefixes (as in mm, km, etc.)</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span></span><span class="p">@</span><span class="n">unit</span> <span class="n">pim</span> <span class="s">&quot;π-meter&quot;</span> <span class="n">π</span><span class="o">*</span><span class="n">m</span> <span class="n">false</span>
<span class="mi">1</span><span class="n">pim</span> <span class="c"># displays as &quot;1 π-meter&quot;</span>
<span class="nb">convert</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="n">pim</span><span class="p">)</span> <span class="c"># evaluates to 3.14159... m</span>
</pre></div>


<p>You can look at <code>Defaults.jl</code> in the package to see what units are there by default.</p>
<p>Note for the experts: Some care should be taken if explicitly making <code>UnitData</code> objects. The ordering of <code>UnitDatum</code> inside a tuple matters for type comparisons. Using the unary multiplication operator on the <code>UnitData</code> object will return a "canonically sorted" <code>UnitData</code> object. Indeed, this is how we avoid ordering issues when multiplying quantities together.</p>
<p><a id='Conversion-and-promotions-1'></a></p>
<h2 id="conversion-and-promotions">Conversion and promotions</h2>
<p>Conversions between units are rejected if the units have different dimensions.</p>
<p>We decide the result units for addition and subtraction operations based on looking at the unit types only. We can't take runtime values into account without compromising runtime performance. By default, if we have <code>x (A) + y (B) = z (C)</code> where <code>x,y,z</code> are numbers and <code>A,B,C</code> are units, then <code>C = max(1A, 1B)</code>. This is an arbitrary choice and can be changed in <code>Defaults.jl</code>. For example, <code>101cm + 1m = 2.01m</code> because <code>1m &gt; 1cm</code>.</p>
<p>Although quantities could be integrated with Julia's promotion mechanisms, we instead simply define how to add or subtract the units themselves, and have addition of quantities rely on those definitions. The concern is that implicit promotion operations that were written with pure numbers in mind may give rise to surprising behavior without returning errors. The operations on the numeric values of quantities of course utilize Julia's promotion mechanisms.</p>
<p>Some of our <code>convert</code> syntax breaks Julia conventions in that the first argument is not a type. For example, <code>convert(ft, 1m)</code> converts 1 meter to feet. This may rub people the wrong way and could change. A neat alternative would be to override other syntax: <code>3m in cm</code> would be succinct and intuitive. Overriding <code>in</code> is simple, but the parsing rules aren't intended for this. For example, <code>0°C in °F == 32°F</code> fails to evaluate, but <code>(0°C in °F) == 32°F</code> returns <code>true</code>.</p>
<p>Exact conversions between units are respected where possible. If rational arithmetic would result in an overflow, then floating-point conversion will proceed.</p>
<p><a id='Temperature-conversion-1'></a></p>
<h2 id="temperature-conversion">Temperature conversion</h2>
<p>If a unit is a pure temperature unit, then conversion respects scale offsets. For instance, converting 0°C to °F returns the expected result, 32°F. If instead temperature appears in combination with other units, scale offsets don't make sense and we consider temperature <em>intervals</em>. This gives the expected behavior most of the time.</p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href=".." title="Home">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Home
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../LICENSE/" title="License">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                License
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'ajkeller34/Unitful.jl';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
      <script src="../assets/mathjaxhelper.js"></script>
    
    
  </body>
</html>